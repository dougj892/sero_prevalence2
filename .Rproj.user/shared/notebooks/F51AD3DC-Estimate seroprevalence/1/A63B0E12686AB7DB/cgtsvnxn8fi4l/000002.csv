"0","# Define the custom family to add to BRMS"
"0","sero_noise <- custom_family("
"0","  ""sero_noise"", "
"0","  links = c(""logit""), "
"0","  type = ""int"""
"0",")"
"0",""
"0","stan_funs <- glue("""
"0","  real sero_noise_lpmf(int y, real mu) {{"
"0","    real pt;"
"0","    pt = mu*{tp/(tp+fn)}+(1-mu)*({1-(tn/(tn+fp))});"
"0","    return bernoulli_lpmf(y | pt);"
"0","  }}"
"0","  real sero_noise_rng(real mu) {{"
"0","    return bernoulli_rng(mu);"
"0","  }}"
"0",""")"
"0",""
"0","stanvars <- stanvar(scode = stan_funs, block = ""functions"")"
"0",""
"0","fit2 <- brm("
"0","  test | trials(1) ~ factor(male) + factor(male) * factor(age) + "
"0","    (1 | state) + (1 | age) + (1 | eth) + (1 | income),"
"0","  family = sero_noise,"
"0","  data = sample, stanvars = stanvars,"
"0","  save_all_pars = TRUE"
"0",")"
"1","
"
"1",""
"1","SAMPLING"
"1",""
"1"," FOR MODEL '"
"1",""
"1","17b74b042036313c360b80dae7aa7a0a"
"1",""
"1","' NOW (CHAIN "
"1",""
"1","1"
"1",""
"1",").
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Gradient evaluation took 0.001 seconds"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","1000 transitions using 10 leapfrog steps per transition would take 10 seconds."
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Adjust your expectations accordingly!"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:    1 / 2000 [  0%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:  200 / 2000 [ 10%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:  400 / 2000 [ 20%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:  600 / 2000 [ 30%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:  800 / 2000 [ 40%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 1000 / 2000 [ 50%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 1001 / 2000 [ 50%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 1200 / 2000 [ 60%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 1400 / 2000 [ 70%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 1600 / 2000 [ 80%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 1800 / 2000 [ 90%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 2000 / 2000 [100%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1"," Elapsed Time: 210.72 seconds (Warm-up)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","               239.076 seconds (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","               449.796 seconds (Total)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","
"
"1",""
"1","SAMPLING"
"1",""
"1"," FOR MODEL '"
"1",""
"1","17b74b042036313c360b80dae7aa7a0a"
"1",""
"1","' NOW (CHAIN "
"1",""
"1","2"
"1",""
"1",").
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Gradient evaluation took 0 seconds"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","1000 transitions using 10 leapfrog steps per transition would take 0 seconds."
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Adjust your expectations accordingly!"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration:    1 / 2000 [  0%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration:  200 / 2000 [ 10%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration:  400 / 2000 [ 20%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration:  600 / 2000 [ 30%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration:  800 / 2000 [ 40%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 1000 / 2000 [ 50%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 1001 / 2000 [ 50%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 1200 / 2000 [ 60%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 1400 / 2000 [ 70%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 1600 / 2000 [ 80%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 1800 / 2000 [ 90%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 2000 / 2000 [100%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","2"
"1",": "
"1"," Elapsed Time: 203.657 seconds (Warm-up)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","               240.828 seconds (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","               444.485 seconds (Total)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","
"
"1",""
"1","SAMPLING"
"1",""
"1"," FOR MODEL '"
"1",""
"1","17b74b042036313c360b80dae7aa7a0a"
"1",""
"1","' NOW (CHAIN "
"1",""
"1","3"
"1",""
"1",").
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Gradient evaluation took 0 seconds"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","1000 transitions using 10 leapfrog steps per transition would take 0 seconds."
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Adjust your expectations accordingly!"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration:    1 / 2000 [  0%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration:  200 / 2000 [ 10%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration:  400 / 2000 [ 20%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration:  600 / 2000 [ 30%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration:  800 / 2000 [ 40%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 1000 / 2000 [ 50%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 1001 / 2000 [ 50%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 1200 / 2000 [ 60%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 1400 / 2000 [ 70%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 1600 / 2000 [ 80%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 1800 / 2000 [ 90%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 2000 / 2000 [100%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","3"
"1",": "
"1"," Elapsed Time: 186.608 seconds (Warm-up)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","               241.647 seconds (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","               428.255 seconds (Total)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"1","
"
"1",""
"1","SAMPLING"
"1",""
"1"," FOR MODEL '"
"1",""
"1","17b74b042036313c360b80dae7aa7a0a"
"1",""
"1","' NOW (CHAIN "
"1",""
"1","4"
"1",""
"1",").
"
"1","Chain "
"1","4"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Gradient evaluation took 0 seconds"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","1000 transitions using 10 leapfrog steps per transition would take 0 seconds."
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Adjust your expectations accordingly!"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","4"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration:    1 / 2000 [  0%]  (Warmup)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration:  200 / 2000 [ 10%]  (Warmup)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration:  400 / 2000 [ 20%]  (Warmup)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration:  600 / 2000 [ 30%]  (Warmup)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration:  800 / 2000 [ 40%]  (Warmup)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration: 1000 / 2000 [ 50%]  (Warmup)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration: 1001 / 2000 [ 50%]  (Sampling)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration: 1200 / 2000 [ 60%]  (Sampling)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration: 1400 / 2000 [ 70%]  (Sampling)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration: 1600 / 2000 [ 80%]  (Sampling)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration: 1800 / 2000 [ 90%]  (Sampling)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","Iteration: 2000 / 2000 [100%]  (Sampling)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","4"
"1",": "
"1"," Elapsed Time: 211.297 seconds (Warm-up)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","               239.359 seconds (Sampling)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1","               450.656 seconds (Total)"
"1","
"
"1","Chain "
"1","4"
"1",": "
"1",""
"1","
"
"2","There were 4000 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See
http://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded"
"2","Examine the pairs() plot to diagnose sampling problems
"
"2","The largest R-hat is 2.13, indicating chains have not mixed.
Running the chains for more iterations may help. See
http://mc-stan.org/misc/warnings.html#r-hat"
"2","Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
http://mc-stan.org/misc/warnings.html#bulk-ess"
"2","Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
http://mc-stan.org/misc/warnings.html#tail-ess"
"0","# Save the stan code and data passed to Stan for further inspection"
"0","cat(stancode(fit2), file = file.path(path,""stan_code"",""brms_code2.stan""))"
"0","model_data2 <- standata(fit2)"
"0",""
