"0","# Define the custom family to add to BRMS"
"0","sero_noise <- custom_family("
"0","  ""sero_noise"", "
"0","  links = c(""logit""), "
"0","  type = ""int"""
"0",")"
"0",""
"0","stan_funs <- glue("""
"0","  real sero_noise_lpmf(int y, real mu) {{"
"0","    real pt;"
"0","    pt = mu*{tp/(tp+fn)}+(1-mu)*({1-(tn/(tn+fp))});"
"0","    return bernoulli_lpmf(y | pt);"
"0","  }}"
"0","  real sero_noise_rng(real mu) {{"
"0","    return bernoulli_rng(mu);"
"0","  }}"
"0",""")"
"0",""
"0","stanvars <- stanvar(scode = stan_funs, block = ""functions"")"
"0",""
"0","fit2 <- brm("
"0","  test | trials(1) ~ factor(male) + factor(male) * factor(age) + "
"0","    (1 | state) + (1 | age) + (1 | eth) + (1 | income),"
"0","  family = sero_noise,"
"0","  data = sample, stanvars = stanvars,"
"0","  save_all_pars = TRUE"
"0",")"
"1","
"
"1",""
"1","SAMPLING"
"1",""
"1"," FOR MODEL '"
"1",""
"1","17b74b042036313c360b80dae7aa7a0a"
"1",""
"1","' NOW (CHAIN "
"1",""
"1","1"
"1",""
"1",").
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Gradient evaluation took 0.001 seconds"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","1000 transitions using 10 leapfrog steps per transition would take 10 seconds."
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Adjust your expectations accordingly!"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:    1 / 2000 [  0%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:  200 / 2000 [ 10%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:  400 / 2000 [ 20%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:  600 / 2000 [ 30%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:  800 / 2000 [ 40%]  (Warmup)"
"1","
"
