"0",""
"0","# Create a new variable that is 1+male since Stan expects sex to be {1,2}^N"
"0","poststrat$sex <- poststrat$male+1"
"0","ps_reordered <- poststrat[c('sex', 'age', 'income', 'state', 'eth', 'N')] %>% "
"0","  arrange(eth, state, income, age, sex)"
"0",""
"0","# Create an array using contents of ps_reordered to pass to Stan"
"0","P <- array(data = ps_reordered$N, "
"0","             dim=head(as.numeric(lapply(ps_reordered, function(x) length(unique(x)))),-1), "
"0","             dimnames=lapply(ps_reordered[,1:(length(ps_reordered)-1)], unique))"
"0",""
"0","# check that P was assigned correctly by looking at the value of N for a random row"
"0","dim(P)"
"1","[1]"
"1","  2"
"1","  7"
"1","  3"
"1"," 50"
"1","  3"
"1","
"
"0","P[1, 3, 2, 45, 2]"
"1","[1]"
"1"," 26873"
"1","
"
"0","ps_reordered %>% filter((sex == 1) & (age == 3) & (income == 2) & (state == 45) & (eth == 2))"
