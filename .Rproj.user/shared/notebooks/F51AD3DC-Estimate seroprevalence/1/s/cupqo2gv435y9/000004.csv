"0",""
"0","# Gather the data in a list"
"0","mmrp_data <-  list(N = nrow(sample),"
"0","                   ng_age = length(unique(ps_reordered$age)),"
"0","                   ng_income = length(unique(ps_reordered$income)),"
"0","                   ng_state = length(unique(ps_reordered$state)),"
"0","                   ng_eth = length(unique(ps_reordered$eth)),"
"0","                   sex = sample$male+1,"
"0","                   age = sample$age,"
"0","                   income = sample$income,"
"0","                   eth = sample$eth,"
"0","                   state = sample$state, "
"0","                   y = sample$cat_pref,"
"0","                   P = P,"
"0","                   tp = tp,  "
"0","                   fn = fn,"
"0","                   tn = tn,"
"0","                   fp = fp)"
"0",""
"0","mmrp_fit <- stan("
"0","  file = file.path(path, ""stan_code"", ""mrp_with_uncertainty.stan""),"
"0","  data = mmrp_data, "
"0","  iter = 1000, chains = 3"
"0","  )"
"1","
"
"1",""
"1","SAMPLING"
"1",""
"1"," FOR MODEL '"
"1",""
"1","mrp_with_uncertainty"
"1",""
"1","' NOW (CHAIN "
"1",""
"1","1"
"1",""
"1",").
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Gradient evaluation took 0.001 seconds"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","1000 transitions using 10 leapfrog steps per transition would take 10 seconds."
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Adjust your expectations accordingly!"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration:   1 / 1000 [  0%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 100 / 1000 [ 10%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 200 / 1000 [ 20%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 300 / 1000 [ 30%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 400 / 1000 [ 40%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 500 / 1000 [ 50%]  (Warmup)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 501 / 1000 [ 50%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 600 / 1000 [ 60%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 700 / 1000 [ 70%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 800 / 1000 [ 80%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 900 / 1000 [ 90%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","Iteration: 1000 / 1000 [100%]  (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","1"
"1",": "
"1"," Elapsed Time: 18.354 seconds (Warm-up)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","               12.689 seconds (Sampling)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1","               31.043 seconds (Total)"
"1","
"
"1","Chain "
"1","1"
"1",": "
"1",""
"1","
"
"1","
"
"1",""
"1","SAMPLING"
"1",""
"1"," FOR MODEL '"
"1",""
"1","mrp_with_uncertainty"
"1",""
"1","' NOW (CHAIN "
"1",""
"1","2"
"1",""
"1",").
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Gradient evaluation took 0.001 seconds"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","1000 transitions using 10 leapfrog steps per transition would take 10 seconds."
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Adjust your expectations accordingly!"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration:   1 / 1000 [  0%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 100 / 1000 [ 10%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 200 / 1000 [ 20%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 300 / 1000 [ 30%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 400 / 1000 [ 40%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 500 / 1000 [ 50%]  (Warmup)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 501 / 1000 [ 50%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 600 / 1000 [ 60%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 700 / 1000 [ 70%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 800 / 1000 [ 80%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 900 / 1000 [ 90%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","Iteration: 1000 / 1000 [100%]  (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","2"
"1",": "
"1"," Elapsed Time: 18.13 seconds (Warm-up)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","               12.784 seconds (Sampling)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1","               30.914 seconds (Total)"
"1","
"
"1","Chain "
"1","2"
"1",": "
"1",""
"1","
"
"1","
"
"1",""
"1","SAMPLING"
"1",""
"1"," FOR MODEL '"
"1",""
"1","mrp_with_uncertainty"
"1",""
"1","' NOW (CHAIN "
"1",""
"1","3"
"1",""
"1",").
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Gradient evaluation took 0.001 seconds"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","1000 transitions using 10 leapfrog steps per transition would take 10 seconds."
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Adjust your expectations accordingly!"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration:   1 / 1000 [  0%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 100 / 1000 [ 10%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 200 / 1000 [ 20%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 300 / 1000 [ 30%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 400 / 1000 [ 40%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 500 / 1000 [ 50%]  (Warmup)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 501 / 1000 [ 50%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 600 / 1000 [ 60%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 700 / 1000 [ 70%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 800 / 1000 [ 80%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 900 / 1000 [ 90%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","Iteration: 1000 / 1000 [100%]  (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"1","Chain "
"1","3"
"1",": "
"1"," Elapsed Time: 18.789 seconds (Warm-up)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","               12.294 seconds (Sampling)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1","               31.083 seconds (Total)"
"1","
"
"1","Chain "
"1","3"
"1",": "
"1",""
"1","
"
"2","There were 1 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See
http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup"
"2","Examine the pairs() plot to diagnose sampling problems
"
"2","The largest R-hat is NA, indicating chains have not mixed.
Running the chains for more iterations may help. See
http://mc-stan.org/misc/warnings.html#r-hat"
"2","Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
http://mc-stan.org/misc/warnings.html#bulk-ess"
"2","Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
http://mc-stan.org/misc/warnings.html#tail-ess"
"0","# Inspect Stan output and compare to the true population figures and the unweighted sample figures."
"0","# The variable phi is the predicted true prevalence for each stratum."
"0","mmrp_draws <- extract(mmrp_fit)"
"0","se_posterior <- mean(mmrp_draws$se)"
"0","sp_posterior <- mean(mmrp_draws$sp)"
"0","pt_pop_posterior <- mean(mmrp_draws$phi)"
"0",""
"0","glue(""The not-so-simple estimate of prevalence is {round(pt_pop_posterior, 3)}"")"
"1","The not-so-simple estimate of prevalence is 0.824"
"1","
"
"0","cat(""The 90% credible interval is"")"
"1","The 90% credible interval is"
"0","quantile(extract(mmrp_fit, pars = ""phi"")[[1]], probs = c(0.05, 0.95))"
"1","       5% "
"1","      95% "
"1","
"
"1","0.7883695 "
"1","0.8562885 "
"1","
"
